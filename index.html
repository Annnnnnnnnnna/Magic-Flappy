<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Flappy Game</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#000;
}
canvas{
  position:fixed;
  inset:0;
}
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  function resize(){
    const dpr = Math.min(2, window.devicePixelRatio || 1);
    canvas.width = innerWidth * dpr;
    canvas.height = innerHeight * dpr;
    canvas.style.width = innerWidth+"px";
    canvas.style.height = innerHeight+"px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener("resize", resize);
  resize();

  // assets
  const bg = new Image(); bg.src="o.png";
  const birdImg = new Image(); birdImg.src="i.png";

  // camera (smooth + shake)
  const camera = {
    x:0,y:0,
    vx:0,vy:0,
    shake:0
  };

  function applyCamera(dt){
    camera.vx *= 0.9;
    camera.vy *= 0.9;
    camera.x += camera.vx * dt;
    camera.y += camera.vy * dt;

    if(camera.shake>0){
      camera.shake -= dt;
      camera.x += (Math.random()-0.5)*camera.shake*8;
      camera.y += (Math.random()-0.5)*camera.shake*8;
    }
  }

  // bird
  const bird = {
    x: innerWidth*0.3,
    y: innerHeight*0.45,
    vy:0,
    w:80,
    h:60
  };

  // particles
  const particles = [];
  function spawnTrail(){
    particles.push({
      x: bird.x+bird.w*0.3,
      y: bird.y+bird.h/2,
      vx: -40-Math.random()*40,
      vy: (Math.random()-0.5)*30,
      life: 0.6
    });
  }

  function updateParticles(dt){
    for(const p of particles){
      p.life -= dt;
      p.x += p.vx*dt;
      p.y += p.vy*dt;
    }
    for(let i=particles.length-1;i>=0;i--){
      if(particles[i].life<=0) particles.splice(i,1);
    }
  }

  function drawParticles(){
    for(const p of particles){
      ctx.globalAlpha = Math.max(0,p.life);
      ctx.fillStyle = "#e6d9ff";
      ctx.beginPath();
      ctx.arc(p.x,p.y,4,0,Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha = 1;
  }

  // pipes
  const pipes=[];
  let spawnTimer=0;
  let speed=240;

  function spawnPipe(){
    const gap=180;
    const y=80+Math.random()*(innerHeight-300);
    pipes.push({x:innerWidth+60,y,gap,passed:false});
  }

  let running=true;
  let last=performance.now();

  function flap(){
    bird.vy=-560;
  }
  window.addEventListener("pointerdown", flap);
  window.addEventListener("keydown", e=>{
    if(e.code==="Space") flap();
  });

  function update(dt){
    bird.vy+=1400*dt;
    bird.y+=bird.vy*dt;

    spawnTimer-=dt;
    if(spawnTimer<=0){
      spawnPipe();
      spawnTimer=1.3;
    }

    for(const p of pipes){
      p.x-=speed*dt;
      if(!p.passed && p.x<bird.x){
        p.passed=true;
      }
      if(
        bird.x+bird.w>p.x &&
        bird.x<p.x+80 &&
        (bird.y<p.y || bird.y+bird.h>p.y+p.gap)
      ){
        // HIT â†’ screen shake
        camera.shake=0.4;
        running=false;
      }
    }

    // trail
    spawnTrail();
    updateParticles(dt);

    // camera follow
    camera.vy += ((bird.y-innerHeight*0.5)-camera.y)*2*dt;
    applyCamera(dt);
  }

  function draw(){
    ctx.save();
    ctx.translate(-camera.x,-camera.y);

    // bg
    if(bg.complete){
      ctx.drawImage(bg,0,0,innerWidth,innerHeight);
    }else{
      ctx.fillStyle="#0b1020";
      ctx.fillRect(0,0,innerWidth,innerHeight);
    }

    // pipes
    ctx.fillStyle="#8f6ae6";
    for(const p of pipes){
      ctx.fillRect(p.x,0,80,p.y);
      ctx.fillRect(p.x,p.y+p.gap,80,innerHeight);
    }

    drawParticles();

    // bird
    ctx.save();
    ctx.translate(bird.x+bird.w/2,bird.y+bird.h/2);
    ctx.rotate(Math.min(1,bird.vy/800));
    if(birdImg.complete){
      ctx.drawImage(birdImg,-bird.w/2,-bird.h/2,bird.w,bird.h);
    }
    ctx.restore();

    ctx.restore();
  }

  function loop(t){
    const dt=Math.min(0.033,(t-last)/1000);
    last=t;
    if(running) update(dt);
    draw();
    requestAnimationFrame(loop);
  }
  loop(last);
})();
</script>
</body>
</html>
